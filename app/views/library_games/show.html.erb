<div class="game_presentation">
  <div class="blob-left-show">
    <%= image_tag("Game_Show/blob_show_left.svg") %>
  </div>
  <div class="blob-right-show">
    <%= image_tag("Game_Show/blob_show_right.svg") %>
  </div>
  <div class="blob_show"><%= image_tag @game.game.image_url %></div>
  <div class="main_infos">
    <div class="colored_infos">
      <% if @game.game.min_players == @game.game.max_players %>
        <div class="colored_info1"><i class="fas fa-users"></i> <%= "#{@game.game.max_players} PLAYERS" %></div>
      <% else %>
        <div class="colored_info1"><i class="fas fa-users"></i> <%= "#{@game.game.min_players} TO #{@game.game.max_players} PLAYERS" %></div>
      <% end %>
      <div class="colored_info2"><i class="fas fa-user"></i> <%= "#{@game.game.min_age} YO +" %></div>
      <div class="colored_info3"><i class="far fa-clock"></i> <%= "#{@game.game.min_playtime}\' - #{@game.game.max_playtime}\'" %></div>
    </div>
    <div class="games_show_rating mt-3"><%= sanitize '<i class="fas fa-star text-info"></i>' * @game.game.rating_general %><%= sanitize '<i class="fas fa-star"></i>' * (5 - @game.game.rating_general) %> <%= @game.game.reviews.count %> reviews</div>
    <div>
      <h1 class="mt-3"><%= @game.game.name %></h1>
      <p class="games_mec_details">
      <strong>Mechanics: </strong>
        <% nb_mechanics = @game.game.mechanics.count < 3 ? @game.game.mechanics.count : 3 %>
        <% @game.game.mechanics.first(nb_mechanics - 1).each do |mechanic| %>
          <%= mechanic.name %> •
        <% end %>
        <%= @game.game.mechanics[nb_mechanics - 1].name %>
      </p>
      <p><%= sanitize @game_short_desc %></p>
      <p class="games_cat_details">
      <strong>Categories: </strong>
        <% nb_categories = @game.game.categories.count < 3 ? @game.game.categories.count : 3 %>
        <% @game.game.categories.first(nb_categories - 1).each do |category| %>
          <%= category.name %> •
        <% end %>
        <%= @game.game.categories[nb_categories - 1].name %>
      </p>
      <!-- Button trigger modal Game Session -->
      <div><button type="button" class="btn-primary" data-toggle="modal" data-target="#gameSessionModal">
        Add a Game Session
      </button></div>
      <!-- Button trigger modal Lend Game -->
      <div class="mt-2">
        <% if @game.borrowed %>
          <% borrower = @game.borrower_type == "User" ? @game.borrower.first_name : @game.borrower.name %>
        <em>You lent this game to <%=borrower%> on <%= @game.borrowed_date  %></em>
        <% else %>
          <button type="button" class="btn-secondary" data-toggle="modal" data-target="#gameLendModal">
            Lend my Game
          </button>
        <% end %>
      </div>
    </div>
  </div>
</div>
<div class="library-games-podium">
  <h2 class="pt-4">Podium</h2>
    <div class="podium-place">
      <div class="place">
        <%= image_tag("Library_Games_Show/second.png", style: "height:100px; margin-bottom:20px; margin-top:20px;") %>
      </div>
      <div class="place">
        <%= image_tag("Library_Games_Show/first.png", style: "height:150px; margin-bottom:20px; margin-top:20px;") %>
      </div>
      <div class="place">
        <%= image_tag("Library_Games_Show/third.png", style: "height:50px; margin-bottom:20px; margin-top:20px;") %>
      </div>
    </div>
    <% if @user_review.present? %>
        <div><div class="reviews">
        <p class="mb-0">My opinion :</p>
            <div class="games_show_rating "><%= sanitize '<i class="fas fa-star text-info"></i>' * @user_review.rating %><%= sanitize '<i class="fas fa-star"></i>' * (5 - @user_review.rating) %> </div>
        </div>
          <p class="global-opinion">Global opinion : <%= @average_rating.truncate(1) %> (<%= @game.game.reviews.count %> reviews)</p>
      </div>
    <% else %>
      <div>
        <button type="button" class="btn-primary mb-4" data-toggle="modal" data-target="#exampleModal">
          I GIVE MY OPINION
        </button>
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title" id="exampleModalLabel">I give my opinion</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
                <%= simple_form_for [@game.game, @review] do |f| %>
                  <div class="modal-body">
                    <%= f.input :text, as: :text, label: "My opinion" %>
                    <%= f.input :rating, as: :hidden %>
                    <div class="my-3">
                      <% 5.times do |index| %>
                        <i id="<%= index + 1 %>" class="review-rating far fa-star truc"></i>
                      <% end %>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="submit" class=" btn-primary">SAVES CHANGES</button>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
</div>
<div class="library-games-stats">
  <h2 class="pt-4">My statistics</h2>
    <div class="statistics">
      <div class="statistics-picto">

        <div class ="statistic-item">
          <%= image_tag("Library_Games_Show/total-duration.png", style: "height:100px; margin-bottom:20px; margin-top:20px;") %>
          <p >Total duration of the game session</p>
        </div>

        <div class ="statistic-item">
          <%= image_tag("Library_Games_Show/average-duration.png", style: "height:100px; margin-bottom:20px; margin-top:20px;") %>
          <p class="statistic-title">Average game session time</p>
        </div>

        <div class ="statistic-item">
          <%= image_tag("Library_Games_Show/winner.png", style: "height:100px; margin-bottom:20px; margin-top:20px;") %>
          <p >Victories</p>
        </div>

        <div class ="statistic-item">
          <%= image_tag("Library_Games_Show/game-sessions-month.png", style: "height:100px; margin-bottom:20px; margin-top:20px;") %>
          <p class="statistic-title"> Games sessions in the month</p>
        </div>

        <div class ="statistic-item">
          <%= image_tag("Library_Games_Show/game-sessions-year.png", style: "height:100px; margin-bottom:20px; margin-top:20px;") %>
          <p class="statistic-title">Total duration of the game session</p>
        </div>
      </div>
    </div>
  <%= link_to "SEE ALL MY STATISTICS", "#", class: "btn-primary" %>

<!-- Modal GameSession & GameSessionPlayers -->
<div class="modal fade" id="gameSessionModal" tabindex="-1" role="dialog" aria-labelledby="gameSessionModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-center" id="gameSessionModalLabel">Add a Game Session</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <%= simple_form_for [@game, @game_session] do |f| %>
          <div class="form-inline">
            <%= f.input :date, as: :string, required: false, input_html: { class: "datepicker", style: "width: 200px; margin: 0px 4px 0px 4px" }, label_html: { style: "margin: 0px 4px 0px 0px" } %>
            <%= f.input :duration, input_html: { style: "width: 70px; margin: 0px 4px 0px 4px" }, wrapper_html: { style: "margin: 0px 4px 0px 10px" }, label: "Duration (min)" %>
          </div>
          <%= f.input :comment, wrapper_html: { style: "margin: 6px 0px 10px 0px" } %>
          <%= abymize(:game_session_players, f) do |abyme| %>
            <%= abyme.records %> <!-- Already existing ones -->
            <%= new_records_for(:game_session_players, f) do |p| %>
              <%= render "abyme/game_session_player_fields", f: p, friends: @players_possibilities %>
            <% end %>
            <%= add_association content: "Add a player", tag: :div, html: { id: "AddPlayer" } %> <!-- Add a new form to add player -->
          <% end %>
          <%= f.submit "Add Session", class: "btn-primary float-right" %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Modal GameLend -->
<div class="modal fade" id="gameLendModal" tabindex="-1" role="dialog" aria-labelledby="gameLendModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-center" id="gameLendModalLabel">Lend my Game</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <%= simple_form_for(@game, url: lend_library_game_path(@game), html: { method: :patch }) do |f| %>
          <div class="form-inline mb-2">
            <%= f.association :borrower, as: :grouped_select, collection: [["Friends", @friends_lend], ["Guests", @guests_lend]], label_method: :first_name, group_method: :last, input_html: {style: "margin: 0px 4px 0px 4px"}, wrapper_html:{style: "margin: 0px 4px 0px 4px"} %>
            <%= f.hidden_field :borrower_type, {value: "User"} %>
            <%= f.input :borrowed_date, as: :string, required: false, label: "Date", input_html: { class: "datepicker", style: "width: 200px; margin: 0px 4px 0px 4px" }, label_html: { style: "margin: 0px 4px 0px 0px" } %>
          </div>
          <%= f.submit "Lend", class: "btn-primary float-right" %>
        <% end %>
      </div>
    </div>
  </div>
</div>
